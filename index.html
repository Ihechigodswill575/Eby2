<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nelly J Stitches - Luxury Fashion</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&family=Montserrat:wght@300;400;500;600&display=swap');
    
    body {
      font-family: 'Montserrat', sans-serif;
    }
    
    h1, h2, h3, h4, h5, h6 {
      font-family: 'Playfair Display', serif;
    }

    .hidden {
      display: none !important;
    }

    .modal-backdrop {
      background: rgba(0, 0, 0, 0.5);
    }
  </style>
</head>
<body class="bg-gradient-to-br from-amber-50 via-white to-amber-50">

  <div id="app"></div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getDatabase, ref, set, push, onValue, update, remove } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCXp9tBR0fBhc8lsv6_0o-8V9SIcBMYp4M",
      authDomain: "websites-171ae.firebaseapp.com",
      databaseURL: "https://websites-171ae-default-rtdb.firebaseio.com",
      projectId: "websites-171ae",
      storageBucket: "websites-171ae.firebasestorage.app",
      messagingSenderId: "1027026269504",
      appId: "1:1027026269504:web:2d797316248b4c1458b6a5"
    };

    const CLOUDINARY_CLOUD_NAME = "dykqgn7xu";
    const CLOUDINARY_UPLOAD_PRESET = "dzxckgbzp";
    const ADMIN_CREDENTIALS = { username: 'nelly_admin', password: 'NellyJ2025!' };

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    let designs = [];
    let isAdmin = localStorage.getItem('nellyAdminSession') === 'true';
    let currentPage = isAdmin ? 'admin' : 'home';
    let selectedDesignId = null;

    const designsRef = ref(database, 'designs');
    onValue(designsRef, (snapshot) => {
      const data = snapshot.val();
      if (data) {
        designs = Object.entries(data).map(([id, design]) => ({
          id,
          ...design,
          comments: design.comments ? Object.entries(design.comments).map(([cid, comment]) => ({
            id: cid,
            ...comment
          })) : []
        })).sort((a, b) => b.timestamp - a.timestamp);
      } else {
        designs = [];
      }
      render();
    });

    async function uploadToCloudinary(file) {
      const formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      formData.append('cloud_name', CLOUDINARY_CLOUD_NAME);

      const response = await fetch(
        `https://api.cloudinary.com/v1_1/${CLOUDINARY_CLOUD_NAME}/image/upload`,
        { method: 'POST', body: formData }
      );
      const data = await response.json();
      return data.secure_url;
    }

    window.handleAdminLogin = function() {
      const username = document.getElementById('adminUsername').value;
      const password = document.getElementById('adminPassword').value;
      
      if (username === ADMIN_CREDENTIALS.username && password === ADMIN_CREDENTIALS.password) {
        isAdmin = true;
        localStorage.setItem('nellyAdminSession', 'true');
        currentPage = 'admin';
        render();
      } else {
        alert('Invalid credentials!');
      }
    };

    window.handleAdminLogout = function() {
      isAdmin = false;
      localStorage.removeItem('nellyAdminSession');
      currentPage = 'home';
      render();
    };

    window.handleDesignUpload = async function(e) {
      e.preventDefault();
      const title = document.getElementById('designTitle').value;
      const category = document.getElementById('designCategory').value;
      const description = document.getElementById('designDescription').value;
      const fileInput = document.getElementById('designImage');
      const file = fileInput.files[0];

      if (!title || !file) {
        alert('Please fill in title and select an image!');
        return;
      }

      const btn = document.getElementById('uploadBtn');
      btn.disabled = true;
      btn.textContent = 'Uploading...';

      try {
        const imageUrl = await uploadToCloudinary(file);
        
        const designRef = push(ref(database, 'designs'));
        await set(designRef, {
          title,
          category,
          description,
          imageUrl,
          likes: 0,
          dislikes: 0,
          timestamp: Date.now()
        });

        alert('Design uploaded successfully!');
        document.getElementById('uploadForm').reset();
        document.getElementById('uploadSection').classList.add('hidden');
      } catch (error) {
        alert('Upload failed: ' + error.message);
      }

      btn.disabled = false;
      btn.textContent = 'Post Design ‚úì';
    };

    window.handleLike = async function(designId, currentLikes) {
      await update(ref(database, `designs/${designId}`), { likes: currentLikes + 1 });
    };

    window.handleDislike = async function(designId, currentDislikes) {
      await update(ref(database, `designs/${designId}`), { dislikes: currentDislikes + 1 });
    };

    window.showCommentModal = function(designId) {
      selectedDesignId = designId;
      const design = designs.find(d => d.id === designId);
      if (!design) return;

      const modal = document.getElementById('commentModal');
      const title = document.getElementById('modalDesignTitle');
      const commentsList = document.getElementById('approvedComments');
      
      title.textContent = design.title;
      
      const approvedComments = design.comments?.filter(c => c.status === 'approved') || [];
      commentsList.innerHTML = approvedComments.length ? approvedComments.map(comment => `
        <div class="border-b pb-3 mb-3">
          <p class="font-semibold">${escapeHtml(comment.name)}</p>
          <p class="text-gray-700">${escapeHtml(comment.text)}</p>
          <p class="text-xs text-gray-400 mt-1">
            ${new Date(comment.timestamp).toLocaleDateString()}
          </p>
        </div>
      `).join('') : '<p class="text-gray-500">No comments yet. Be the first!</p>';
      
      modal.classList.remove('hidden');
    };

    window.closeCommentModal = function() {
      document.getElementById('commentModal').classList.add('hidden');
      document.getElementById('commentName').value = '';
      document.getElementById('commentText').value = '';
      selectedDesignId = null;
    };

    window.handleCommentSubmit = async function() {
      const name = document.getElementById('commentName').value.trim();
      const text = document.getElementById('commentText').value.trim();

      if (!name || !text) {
        alert('Please fill in both name and comment!');
        return;
      }

      const commentRef = push(ref(database, `designs/${selectedDesignId}/comments`));
      await set(commentRef, {
        name,
        text,
        status: 'pending',
        timestamp: Date.now()
      });

      alert('Comment submitted for approval!');
      closeCommentModal();
    };

    window.approveComment = async function(designId, commentId) {
      await update(ref(database, `designs/${designId}/comments/${commentId}`), { status: 'approved' });
    };

    window.rejectComment = async function(designId, commentId) {
      await remove(ref(database, `designs/${designId}/comments/${commentId}`));
    };

    window.deleteDesign = async function(designId) {
      if (confirm('Are you sure you want to delete this design?')) {
        await remove(ref(database, `designs/${designId}`));
      }
    };

    window.goToPage = function(page) {
      currentPage = page;
      render();
    };

    window.toggleUploadSection = function() {
      document.getElementById('uploadSection').classList.toggle('hidden');
    };

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function getPendingCount() {
      let count = 0;
      designs.forEach(design => {
        design.comments?.forEach(comment => {
          if (comment.status === 'pending') count++;
        });
      });
      return count;
    }

    function render() {
      const appDiv = document.getElementById('app');
      
      if (currentPage === 'admin-login') {
        appDiv.innerHTML = `
          <div class="min-h-screen flex items-center justify-center p-4">
            <div class="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
              <div class="text-center mb-8">
                <div class="text-6xl mb-4">‚úÇÔ∏è</div>
                <h2 class="text-3xl font-bold text-gray-900">Admin Login</h2>
                <p class="text-gray-600 mt-2">Nelly J Stitches Dashboard</p>
              </div>
              
              <div class="space-y-4">
                <input
                  type="text"
                  id="adminUsername"
                  placeholder="Username"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"
                />
                <input
                  type="password"
                  id="adminPassword"
                  placeholder="Password"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500"
                  onkeypress="if(event.key==='Enter') handleAdminLogin()"
                />
                <button
                  onclick="handleAdminLogin()"
                  class="w-full bg-amber-600 text-white py-3 rounded-lg hover:bg-amber-700 font-semibold"
                >
                  Login
                </button>
                <button
                  onclick="goToPage('home')"
                  class="w-full bg-gray-200 text-gray-700 py-3 rounded-lg hover:bg-gray-300"
                >
                  Back to Website
                </button>
              </div>
            </div>
          </div>
        `;
        return;
      }

      if (currentPage === 'admin' && isAdmin) {
        const pendingCount = getPendingCount();
        const totalLikes = designs.reduce((sum, d) => sum + (d.likes || 0), 0);
        
        appDiv.innerHTML = `
          <div class="min-h-screen bg-gray-50">
            <div class="bg-white shadow-md p-4 flex justify-between items-center">
              <h1 class="text-2xl font-bold text-gray-900">üé® Nelly J Admin</h1>
              <button onclick="handleAdminLogout()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                Logout
              </button>
            </div>

            <div class="max-w-7xl mx-auto p-6">
              <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-white p-6 rounded-lg shadow-md">
                  <h3 class="text-gray-600 text-sm font-semibold">Total Designs</h3>
                  <p class="text-4xl font-bold text-amber-600 mt-2">${designs.length}</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                  <h3 class="text-gray-600 text-sm font-semibold">Total Likes</h3>
                  <p class="text-4xl font-bold text-red-500 mt-2">${totalLikes}</p>
                </div>
                <div class="bg-white p-6 rounded-lg shadow-md">
                  <h3 class="text-gray-600 text-sm font-semibold">Pending Comments</h3>
                  <p class="text-4xl font-bold text-yellow-600 mt-2">${pendingCount}</p>
                </div>
              </div>

              <button onclick="toggleUploadSection()" class="w-full bg-amber-600 text-white py-4 rounded-lg hover:bg-amber-700 font-semibold mb-6">
                üì§ Upload New Design
              </button>

              <div id="uploadSection" class="hidden bg-white p-6 rounded-lg shadow-md mb-8">
                <h3 class="text-xl font-bold mb-4">Upload New Design</h3>
                <form id="uploadForm" onsubmit="handleDesignUpload(event)" class="space-y-4">
                  <input type="text" id="designTitle" placeholder="Design Title" required class="w-full px-4 py-3 border rounded-lg" />
                  <select id="designCategory" class="w-full px-4 py-3 border rounded-lg">
                    <option>Bridal</option>
                    <option>Casual</option>
                    <option>Corporate</option>
                    <option>Aso-ebi</option>
                  </select>
                  <textarea id="designDescription" placeholder="Description" class="w-full px-4 py-3 border rounded-lg h-24"></textarea>
                  <input type="file" id="designImage" accept="image/*" required class="w-full px-4 py-3 border rounded-lg" />
                  <button type="submit" id="uploadBtn" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700">
                    Post Design ‚úì
                  </button>
                </form>
              </div>

              ${pendingCount > 0 ? `
                <div class="bg-yellow-50 border-2 border-yellow-400 p-6 rounded-lg mb-8">
                  <h3 class="text-xl font-bold mb-4">üì¨ Pending Comments (${pendingCount})</h3>
                  <div class="space-y-4">
                    ${designs.map(design => 
                      design.comments?.filter(c => c.status === 'pending').map(comment => `
                        <div class="bg-white p-4 rounded-lg shadow">
                          <p class="font-semibold text-sm text-gray-600">Design: ${escapeHtml(design.title)}</p>
                          <p class="font-semibold mt-2">From: ${escapeHtml(comment.name)}</p>
                          <p class="text-gray-700 mt-1">"${escapeHtml(comment.text)}"</p>
                          <div class="flex gap-2 mt-3">
                            <button onclick="approveComment('${design.id}', '${comment.id}')" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600">
                              ‚úì Approve
                            </button>
                            <button onclick="rejectComment('${design.id}', '${comment.id}')" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                              ‚úï Reject
                            </button>
                          </div>
                        </div>
                      `).join('') || ''
                    ).join('')}
                  </div>
                </div>
              ` : ''}

              <div class="bg-white p-6 rounded-lg shadow-md">
                <h3 class="text-xl font-bold mb-4">üé® All Designs</h3>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                  ${designs.map(design => `
                    <div class="border rounded-lg overflow-hidden">
                      <img src="${design.imageUrl}" alt="${escapeHtml(design.title)}" class="w-full h-48 object-cover" />
                      <div class="p-4">
                        <h4 class="font-bold">${escapeHtml(design.title)}</h4>
                        <p class="text-sm text-gray-600">${escapeHtml(design.category)}</p>
                        <div class="flex gap-2 mt-3 text-sm">
                          <span>‚ù§Ô∏è ${design.likes || 0}</span>
                          <span>üí¨ ${design.comments?.filter(c => c.status === 'approved').length || 0}</span>
                        </div>
                        <button onclick="deleteDesign('${design.id}')" class="w-full mt-3 bg-red-500 text-white py-2 rounded hover:bg-red-600">
                          üóëÔ∏è Delete
                        </button>
                      </div>
                    </div>
                  `).join('')}
                </div>
              </div>
            </div>
          </div>
        `;
        return;
      }

      // Public Website
      appDiv.innerHTML = `
        <header class="fixed top-0 w-full z-50 bg-white shadow-md">
          <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
              <span class="text-3xl">‚úÇÔ∏è</span>
              <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Nelly J Stitches</h1>
            </div>
            <nav class="hidden md:flex gap-8 text-gray-700 font-medium">
              <a href="#home" class="hover:text-amber-600">Home</a>
              <a href="#designs" class="hover:text-amber-600">Designs</a>
              <a href="#about" class="hover:text-amber-600">About</a>
              <a href="#contact" class="hover:text-amber-600">Contact</a>
            </nav>
          </div>
        </header>

        <section id="home" class="pt-32 pb-20 px-4">
          <div class="max-w-7xl mx-auto text-center">
            <h2 class="text-5xl md:text-7xl font-bold text-gray-900 mb-6">Handcrafted Elegance</h2>
            <p class="text-xl md:text-2xl text-gray-600 mb-8">Custom tailoring made with perfection</p>
            <div class="flex gap-4 justify-center flex-wrap">
              <a href="#designs" class="bg-amber-600 text-white px-8 py-4 rounded-lg hover:bg-amber-700 font-semibold">
                View Designs
              </a>
              <a href="https://wa.me/2348012345678" class="bg-gray-900 text-white px-8 py-4 rounded-lg hover:bg-gray-800 font-semibold">
                Book a Fitting
              </a>
            </div>
          </div>
        </section>

        <section id="designs" class="py-20 px-4 bg-white">
          <div class="max-w-7xl mx-auto">
            <h2 class="text-4xl font-bold text-center mb-12">Latest Designs</h2>
            
            ${designs.length === 0 ? `
              <div class="text-center text-gray-500 py-20">
                <p class="text-xl">No designs yet. Check back soon!</p>
              </div>
            ` : `
              <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                ${designs.map(design => `
                  <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-2xl transition-all">
                    <img src="${design.imageUrl}" alt="${escapeHtml(design.title)}" class="w-full h-80 object-cover" />
                    
                    <div class="p-6">
                      <h3 class="text-xl font-bold mb-2">${escapeHtml(design.title)}</h3>
                      <p class="text-sm text-gray-600 mb-2">${escapeHtml(design.category)}</p>
                      <p class="text-gray-700 mb-4">${escapeHtml(design.description || '')}</p>
                      
                      <div class="flex gap-6 mb-4 text-gray-600">
                        <button onclick="handleLike('${design.id}', ${design.likes || 0})" class="flex items-center gap-2 hover:text-red-500 cursor-pointer">
                          <span>‚ù§Ô∏è</span>
                          <span>${design.likes || 0}</span>
                        </button>
                        <button onclick="handleDislike('${design.id}', ${design.dislikes || 0})" class="flex items-center gap-2 hover:text-gray-800 cursor-pointer">
                          <span>üëé</span>
                          <span>${design.dislikes || 0}</span>
                        </button>
                        <button onclick="showCommentModal('${design.id}')" class="flex items-center gap-2 hover:text-amber-600 cursor-pointer">
                          <span>üí¨</span>
                          <span>${design.comments?.filter(c => c.status === 'approved').length || 0}</span>
                        </button>
                      </div>

                      ${design.comments?.filter(c => c.status === 'approved').slice(0, 2).map(comment => `
                        <div class="border-t pt-3 mt-3">
                          <p class="font-semibold text-sm">${escapeHtml(comment.name)}</p>
                          <p class="text-sm text-gray-600">${escapeHtml(comment.text)}</p>
                        </div>
                      `).join('') || ''}
                    </div>
                  </div>
                `).join('')}
              </div>
            `}
          </div>
        </section>

        <section id="about" class="py-20 px-4">
          <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl font-bold mb-6">About Nelly J Stitches</h2>
            <p class="text-lg text-gray-700 leading-relaxed mb-8">
              With years of passion and craftsmanship, Nelly J Stitches brings you custom-tailored 
              elegance that fits perfectly. Every stitch tells a story of dedication, quality, 
              and timeless fashion.
            </p>
          </div>
        </section>

        <section class="py-20 px-4 bg-gradient-to-r from-amber-600 to-amber-800 text-white">
          <div class="max-w-4xl mx-auto text-center">
            <h2 class="text-4xl md:text-5xl font-bold mb-6">Your Style, Perfectly Stitched</h2>
            <p class="text-xl mb-8">Ready to create your dream outfit?</p>
            <a href="https://wa.me/2348012345678" class="inline-block bg-white text-amber-600 px-8 py-4 rounded-lg hover:bg-gray-100 font-semibold">
              üìû WhatsApp Order
            </a>
          </div>
        </section>

        <footer id="contact" class="bg-gray-900 text-white py-12 px-4">
          <div class="max-w-7xl mx-auto">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
              <div>
                <div class="flex items-center gap-3 mb-4">
                  <span class="text-3xl">‚úÇÔ∏è</span>
                  <h3 class="text-2xl font-bold">Nelly J Stitches</h3>
                </div>
                <p class="text-gray-400">Handcrafted elegance, custom tailoring made with perfection.</p>
              </div>
              
              <div>
                <h4 class="font-bold text-lg mb-4">Contact</h4>
                <div class="space-y-3 text-gray-400">
                  <div>üìû +234 801 234 5678</div>
                  <div>üìç Lagos, Nigeria</div>
                </div>
              </div>

              <div>
                <h4 class="font-bold text-lg mb-4">Follow Us</h4>
                <div class="flex gap-4 text-2xl">
                  <a href="https://instagram.com/nellyjstitches" class="hover:text-amber-400">üì∑</a>
                  <a href="https://wa.me/2348012345678" class="hover:text-amber-400">üìû</a>
                </div>
              </div>
            </div>

            <div class="border-t border-gray-800 pt-8 text-center text-gray-400">
              <p>&copy; 2025 Nelly J Stitches. All rights reserved.</p>
              ${!isAdmin ? `
                <button onclick="goToPage('admin-login')" class="text-xs text-gray-600 hover:text-gray-400 mt-2">‚Ä¢</button>
              ` : ''}
            </div>
          </div>
        </footer>

        <div id="commentModal" class="hidden fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
          <div class="bg-white rounded-lg max-w-md w-full max-h-[80vh] overflow-y-auto p-6">
            <div class="flex justify-between items-center mb-4">
              <h3 id="modalDesignTitle" class="text-xl font-bold">Comments</h3>
              <button onclick="closeCommentModal()" class="text-2xl hover:text-gray-600">‚úï</button>
            </div>

            <div id="approvedComments" class="space-y-4 mb-6"></div>

            <div class="space-y-3">
              <input type="text" id="commentName" placeholder="Your Name" class="w-full px-4 py-2 border rounded-lg" />
              <textarea id="commentText" placeholder="Your Comment" class="w-full px-4 py-2 border rounded-lg h-24"></textarea>
              <button onclick="handleCommentSubmit()" class="w-full bg-amber-600 text-white py-3 rounded-lg hover:bg-amber-700">
                Submit Comment
              </button>
            </div>
          </div>
        </div>
      `;
    }

    render();
  </script>

</body>
</html>
