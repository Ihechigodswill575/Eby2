<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GodswillChatbot - AI at your fingertips</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f5f5f5;
      color: #333;
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Dark Mode */
    body.dark-mode {
      background: #0a0a0a;
      color: #e0e0e0;
    }

    /* Header */
    .header {
      background: #1a1a40;
      color: white;
      padding: clamp(1rem, 3vw, 1.5rem);
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .logo {
      display: flex;
      flex-direction: column;
    }

    .logo h1 {
      font-size: clamp(1.3rem, 4vw, 2rem);
      font-weight: 700;
      color: #39ff14;
    }

    .logo p {
      font-size: clamp(0.75rem, 2vw, 0.95rem);
      color: #ccc;
      margin-top: 0.2rem;
    }

    .header-controls {
      display: flex;
      gap: 0.8rem;
      align-items: center;
    }

    .dark-mode-toggle {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      padding: 0.6rem 1rem;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      font-size: clamp(0.85rem, 2vw, 1rem);
      transition: all 0.3s;
    }

    .dark-mode-toggle:hover {
      background: rgba(255, 255, 255, 0.3);
    }

    /* Main Chat Container */
    .chat-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      padding: clamp(1rem, 3vw, 2rem);
      overflow: hidden;
    }

    /* Messages Area */
    .messages-area {
      flex: 1;
      overflow-y: auto;
      padding: clamp(1rem, 2vw, 1.5rem);
      display: flex;
      flex-direction: column;
      gap: 1.2rem;
      background: white;
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 1rem;
    }

    body.dark-mode .messages-area {
      background: #1a1a1a;
    }

    .messages-area::-webkit-scrollbar {
      width: 8px;
    }

    .messages-area::-webkit-scrollbar-track {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 10px;
    }

    .messages-area::-webkit-scrollbar-thumb {
      background: #1a1a40;
      border-radius: 10px;
    }

    /* Welcome Message */
    .welcome-message {
      text-align: center;
      padding: 3rem 1rem;
      color: #666;
    }

    body.dark-mode .welcome-message {
      color: #999;
    }

    .welcome-message h2 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      color: #1a1a40;
      margin-bottom: 1rem;
    }

    body.dark-mode .welcome-message h2 {
      color: #39ff14;
    }

    .welcome-message p {
      font-size: clamp(0.9rem, 2vw, 1.1rem);
    }

    /* Message Bubbles */
    .message {
      display: flex;
      gap: 0.8rem;
      animation: slideIn 0.3s ease;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .message.user {
      justify-content: flex-end;
    }

    .message.ai {
      justify-content: flex-start;
    }

    .message-content {
      max-width: 70%;
      padding: 1rem 1.2rem;
      border-radius: 20px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      line-height: 1.5;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: relative;
      word-wrap: break-word;
    }

    .message.user .message-content {
      background: #1a1a40;
      color: white;
      border-bottom-right-radius: 5px;
    }

    .message.ai .message-content {
      background: #f0f0f0;
      color: #333;
      border-bottom-left-radius: 5px;
    }

    body.dark-mode .message.ai .message-content {
      background: #2a2a2a;
      color: #e0e0e0;
    }

    .speak-btn {
      background: #39ff14;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 8px;
      color: #1a1a40;
      font-weight: 600;
      cursor: pointer;
      margin-top: 0.5rem;
      font-size: clamp(0.8rem, 2vw, 0.9rem);
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .speak-btn:hover {
      background: #2ecc11;
      transform: scale(1.05);
    }

    .speak-btn.speaking {
      background: #ff6b6b;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Input Area */
    .input-area {
      display: flex;
      gap: 0.8rem;
      align-items: center;
      background: white;
      padding: clamp(0.8rem, 2vw, 1.2rem);
      border-radius: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    }

    body.dark-mode .input-area {
      background: #1a1a1a;
    }

    .mic-btn {
      background: #39ff14;
      border: none;
      width: clamp(45px, 10vw, 55px);
      height: clamp(45px, 10vw, 55px);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: clamp(1.2rem, 3vw, 1.5rem);
      transition: all 0.3s;
      flex-shrink: 0;
    }

    .mic-btn:hover {
      background: #2ecc11;
      transform: scale(1.1);
    }

    .mic-btn.recording {
      background: #ff4444;
      animation: pulse 1s infinite;
    }

    .input-box {
      flex: 1;
      padding: clamp(0.8rem, 2vw, 1rem);
      border: 2px solid #ddd;
      border-radius: 15px;
      font-size: clamp(0.9rem, 2vw, 1rem);
      font-family: 'Poppins', sans-serif;
      outline: none;
      transition: border-color 0.3s;
    }

    body.dark-mode .input-box {
      background: #2a2a2a;
      border-color: #444;
      color: #e0e0e0;
    }

    .input-box:focus {
      border-color: #1a1a40;
    }

    body.dark-mode .input-box:focus {
      border-color: #39ff14;
    }

    .send-btn {
      background: #1a1a40;
      border: none;
      padding: clamp(0.8rem, 2vw, 1rem) clamp(1.2rem, 3vw, 1.8rem);
      border-radius: 15px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      font-size: clamp(0.9rem, 2vw, 1rem);
      transition: all 0.3s;
      flex-shrink: 0;
      min-height: 44px;
    }

    .send-btn:hover {
      background: #2a2a60;
      transform: translateY(-2px);
    }

    .send-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    /* Loading Animation */
    .typing-indicator {
      display: none;
      padding: 1rem;
      background: #f0f0f0;
      border-radius: 20px;
      max-width: 70px;
      border-bottom-left-radius: 5px;
    }

    body.dark-mode .typing-indicator {
      background: #2a2a2a;
    }

    .typing-indicator.active {
      display: block;
    }

    .typing-indicator span {
      display: inline-block;
      width: 8px;
      height: 8px;
      background: #1a1a40;
      border-radius: 50%;
      margin: 0 2px;
      animation: typing 1.4s infinite;
    }

    body.dark-mode .typing-indicator span {
      background: #39ff14;
    }

    .typing-indicator span:nth-child(2) {
      animation-delay: 0.2s;
    }

    .typing-indicator span:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typing {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-10px);
      }
    }

    /* Footer */
    .footer {
      background: #1a1a40;
      color: white;
      padding: clamp(1rem, 3vw, 1.5rem);
      text-align: center;
    }

    .footer-links {
      display: flex;
      justify-content: center;
      gap: clamp(1rem, 4vw, 2rem);
      margin-bottom: 0.8rem;
      flex-wrap: wrap;
    }

    .footer-links a {
      color: #39ff14;
      text-decoration: none;
      font-size: clamp(0.85rem, 2vw, 1rem);
      transition: color 0.3s;
    }

    .footer-links a:hover {
      color: #2ecc11;
      text-decoration: underline;
    }

    .copyright {
      font-size: clamp(0.75rem, 1.8vw, 0.9rem);
      color: #ccc;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .message-content {
        max-width: 85%;
      }
    }

    @media (max-width: 480px) {
      .message-content {
        max-width: 90%;
      }
      
      .input-area {
        flex-wrap: wrap;
      }
      
      .input-box {
        order: 1;
        width: 100%;
      }
      
      .mic-btn {
        order: 2;
      }
      
      .send-btn {
        order: 3;
        flex: 1;
      }
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <div class="logo">
      <h1>GodswillChatbot</h1>
      <p>Chat, Speak, Listen ‚Äì AI at your fingertips</p>
    </div>
    <div class="header-controls">
      <button class="dark-mode-toggle" onclick="toggleDarkMode()">üåô Dark Mode</button>
    </div>
  </div>

  <!-- Chat Container -->
  <div class="chat-container">
    <div class="messages-area" id="messagesArea">
      <div class="welcome-message">
        <h2>üëã Welcome to GodswillChatbot!</h2>
        <p>Type a message, or click the mic üé§ to speak. I'm here to help!</p>
      </div>
    </div>

    <!-- Typing Indicator -->
    <div class="typing-indicator" id="typingIndicator">
      <span></span>
      <span></span>
      <span></span>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <button class="mic-btn" id="micBtn" onclick="startVoiceInput()">üé§</button>
      <input type="text" class="input-box" id="messageInput" placeholder="Type your message here..." onkeypress="handleKeyPress(event)">
      <button class="send-btn" id="sendBtn" onclick="sendMessage()">Send</button>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <div class="footer-links">
      <a href="#about" onclick="showAbout()">About</a>
      <a href="#api" onclick="showAPI()">API Info</a>
      <a href="#contact" onclick="showContact()">Contact</a>
    </div>
    <p class="copyright">¬© 2025 GodswillChatbot</p>
  </div>

  <script>
    // Configuration - Using a more reliable model
    const HUGGINGFACE_TOKEN = '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';
    const HF_API_URL = 'https://api-inference.huggingface.co/models/microsoft/DialoGPT-medium';
    
    // Web Speech API
    let recognition;
    let isRecording = false;
    let conversationHistory = [];

    // Initialize Speech Recognition
    if ('webkitSpeechRecognition' in window) {
      recognition = new webkitSpeechRecognition();
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = function(event) {
        const transcript = event.results[0][0].transcript;
        document.getElementById('messageInput').value = transcript;
        stopVoiceInput();
        sendMessage();
      };

      recognition.onerror = function(event) {
        console.error('Speech recognition error:', event.error);
        stopVoiceInput();
      };

      recognition.onend = function() {
        stopVoiceInput();
      };
    }

    // Dark Mode Toggle
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      const btn = document.querySelector('.dark-mode-toggle');
      if (document.body.classList.contains('dark-mode')) {
        btn.textContent = '‚òÄÔ∏è Light Mode';
      } else {
        btn.textContent = 'üåô Dark Mode';
      }
    }

    // Handle Enter Key
    function handleKeyPress(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // Voice Input
    function startVoiceInput() {
      if (!recognition) {
        alert('Speech recognition is not supported in your browser. Please use Chrome or Edge.');
        return;
      }

      if (isRecording) {
        stopVoiceInput();
      } else {
        isRecording = true;
        const micBtn = document.getElementById('micBtn');
        micBtn.classList.add('recording');
        micBtn.textContent = '‚èπÔ∏è';
        recognition.start();
      }
    }

    function stopVoiceInput() {
      if (recognition && isRecording) {
        recognition.stop();
        isRecording = false;
        const micBtn = document.getElementById('micBtn');
        micBtn.classList.remove('recording');
        micBtn.textContent = 'üé§';
      }
    }

    // Send Message with better error handling
    async function sendMessage() {
      const input = document.getElementById('messageInput');
      const message = input.value.trim();
      
      if (!message) return;

      // Add user message
      addMessage(message, 'user');
      input.value = '';

      // Add to conversation history
      conversationHistory.push(message);

      // Show typing indicator
      const typingIndicator = document.getElementById('typingIndicator');
      typingIndicator.classList.add('active');

      // Disable send button
      const sendBtn = document.getElementById('sendBtn');
      sendBtn.disabled = true;

      try {
        // Try with retry logic
        let response;
        let attempts = 0;
        const maxAttempts = 3;

        while (attempts < maxAttempts) {
          try {
            response = await fetch(HF_API_URL, {
              method: 'POST',
              headers: {
                'Authorization': `Bearer ${HUGGINGFACE_TOKEN}`,
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({
                inputs: {
                  past_user_inputs: conversationHistory.slice(-5, -1),
                  generated_responses: [],
                  text: message
                },
                options: {
                  wait_for_model: true
                }
              })
            });

            if (response.ok) {
              break;
            } else if (response.status === 503) {
              // Model is loading, wait and retry
              await new Promise(resolve => setTimeout(resolve, 2000));
              attempts++;
            } else {
              throw new Error(`API Error: ${response.status}`);
            }
          } catch (error) {
            attempts++;
            if (attempts >= maxAttempts) {
              throw error;
            }
            await new Promise(resolve => setTimeout(resolve, 2000));
          }
        }

        const data = await response.json();
        let aiResponse = '';

        // Parse response
        if (data.generated_text) {
          aiResponse = data.generated_text.trim();
        } else if (data.error) {
          // If model is still loading, use fallback response
          aiResponse = getFallbackResponse(message);
        } else {
          aiResponse = 'I heard you! Could you rephrase that?';
        }

        // Clean up response
        aiResponse = aiResponse.replace(message, '').trim();
        if (!aiResponse || aiResponse.length < 2) {
          aiResponse = getFallbackResponse(message);
        }

        // Add AI message
        addMessage(aiResponse, 'ai');

      } catch (error) {
        console.error('Error:', error);
        // Use intelligent fallback
        const fallbackResponse = getFallbackResponse(message);
        addMessage(fallbackResponse, 'ai');
      } finally {
        typingIndicator.classList.remove('active');
        sendBtn.disabled = false;
      }
    }

    // Intelligent fallback responses
    function getFallbackResponse(message) {
      const lowerMessage = message.toLowerCase();
      
      if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey')) {
        return "Hello! I'm GodswillChatbot. How can I help you today?";
      } else if (lowerMessage.includes('how are you')) {
        return "I'm doing great! Thanks for asking. How can I assist you?";
      } else if (lowerMessage.includes('your name')) {
        return "I'm GodswillChatbot, your AI assistant!";
      } else if (lowerMessage.includes('what can you do')) {
        return "I can chat with you, answer questions, and even speak my responses! Try asking me anything.";
      } else if (lowerMessage.includes('thank')) {
        return "You're welcome! Happy to help!";
      } else if (lowerMessage.includes('bye')) {
        return "Goodbye! Come back anytime!";
      } else {
        const responses = [
          "That's interesting! Tell me more.",
          "I understand. How can I help with that?",
          "Got it! What else would you like to know?",
          "Interesting question! Let me think about that.",
          "I'm here to help! What would you like to know more about?"
        ];
        return responses[Math.floor(Math.random() * responses.length)];
      }
    }

    // Add Message to Chat
    function addMessage(text, sender) {
      const messagesArea = document.getElementById('messagesArea');
      const welcomeMessage = messagesArea.querySelector('.welcome-message');
      if (welcomeMessage) {
        welcomeMessage.remove();
      }

      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${sender}`;

      const contentDiv = document.createElement('div');
      contentDiv.className = 'message-content';
      contentDiv.textContent = text;

      messageDiv.appendChild(contentDiv);

      // Add speak button for AI messages
      if (sender === 'ai') {
        const speakBtn = document.createElement('button');
        speakBtn.className = 'speak-btn';
        speakBtn.innerHTML = 'üîä Listen';
        speakBtn.onclick = () => speakText(text, speakBtn);
        contentDiv.appendChild(speakBtn);
      }

      messagesArea.appendChild(messageDiv);
      messagesArea.scrollTop = messagesArea.scrollHeight;
    }

    // Text-to-Speech
    function speakText(text, button) {
      // Stop current speech if any
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
        const allButtons = document.querySelectorAll('.speak-btn');
        allButtons.forEach(btn => {
          btn.classList.remove('speaking');
          btn.textContent = 'üîä Listen';
        });
        return;
      }

      if ('speechSynthesis' in window) {
        button.classList.add('speaking');
        button.textContent = '‚èπÔ∏è Stop';

        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = 0.9;
        utterance.pitch = 1;
        utterance.volume = 1;

        utterance.onend = () => {
          button.classList.remove('speaking');
          button.textContent = 'üîä Listen';
        };

        utterance.onerror = () => {
          button.classList.remove('speaking');
          button.textContent = 'üîä Listen';
        };

        speechSynthesis.speak(utterance);
      } else {
        alert('Text-to-speech is not supported in your browser.');
      }
    }

    // Footer Functions
    function showAbout() {
      addMessage('GodswillChatbot is an AI-powered chatbot that can chat with you via text or voice! Built with Hugging Face AI and Web Speech APIs. I can understand your questions and provide helpful responses.', 'ai');
    }

    function showAPI() {
      addMessage('This chatbot uses Hugging Face\'s DialoGPT model for conversational AI. Voice features use the Web Speech API for speech recognition and synthesis, making our conversations more natural!', 'ai');
    }

    function showContact() {
      addMessage('üì± WhatsApp: +2347033572513\nüìß Email: ihechigodswill575@gmail.com\n\nFeel free to reach out anytime!', 'ai');
    }
  </script>

</body>
</html>
